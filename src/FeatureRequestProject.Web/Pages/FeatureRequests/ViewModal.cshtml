@page
@using FeatureRequestProject.Localization
@using FeatureRequestProject.Web.Pages.FeatureRequests
@using Microsoft.Extensions.Localization
@using Volo.Abp.AspNetCore.Mvc.UI.Bootstrap.TagHelpers.Modal
@using Volo.Abp.Users
@model ViewModalModel
@inject ICurrentUser CurrentUser
@inject IStringLocalizer<FeatureRequestProjectResource> L
@{
	Layout = null;
}

<abp-modal size="Large">
	<abp-modal-header title="@Model.FeatureRequest.Title"></abp-modal-header>

	<abp-modal-body>

		<abp-card>
			<abp-card-body>
				<h6 class="text-primary fw-bold">@L["Description"]</h6>
				<p class="text-muted" style="white-space: pre-wrap;">@Model.FeatureRequest.Description</p>
			</abp-card-body>
		</abp-card>

		<abp-row class="mt-3 align-items-center">

			<abp-column size-md="_6">
				<abp-badge pill="true" theme="Info" class="p-2 text-decoration-none">
					<i class="fa fa-tag me-1"></i> @L[$"Enum:Category.{(int)Model.FeatureRequest.CategoryId}"]
				</abp-badge>

				<abp-badge pill="true" theme="Warning" class="p-2 ms-1 text-decoration-none text-dark">
					<i class="fa fa-info-circle me-1"></i> @L[$"Enum:Status.{(int)Model.FeatureRequest.Status}"]
				</abp-badge>
			</abp-column>

			<abp-column size-md="_6" class="text-end">
				<span class="me-2 small text-muted">@L["DidYouFindThisHelpful"]</span>

				<abp-button button-type="Outline_Success" size="Small" icon="thumbs-up"
							class="modal-vote-btn"
							data-id="@Model.FeatureRequest.Id" data-type="1" />

				<abp-button button-type="Outline_Danger" size="Small" icon="thumbs-down"
							class="modal-vote-btn"
							data-id="@Model.FeatureRequest.Id" data-type="-1" />
			</abp-column>
		</abp-row>

		<abp-row class="mt-4 border-bottom pb-2 mb-3">
			<abp-column size="_12">
				<h6 class="fw-bold text-primary">
					<i class="fa fa-comments me-2"></i> @L["Comments"]
				</h6>
			</abp-column>
		</abp-row>

		<div id="comments-section" style="max-height: 400px; overflow-y: auto;">
			@if (Model.FeatureRequest.Comments == null || !Model.FeatureRequest.Comments.Any())
			{
				<div class="text-center py-4">
					<p class="text-muted">@L["NoCommentsYet"]</p>
				</div>
			}
			else
			{
				@foreach (var comment in Model.FeatureRequest.Comments.OrderByDescending(c => c.CreationTime))
				{
					<abp-row class="mb-3 border-bottom pb-3">
						<abp-column size-auto="_true">
							<div class="rounded-circle bg-light border d-flex align-items-center justify-content-center text-primary fw-bold"
								 style="width: 40px; height: 40px;">
								@comment.UserName.Substring(0, 1).ToUpper()
							</div>
						</abp-column>

						<abp-column>
							<div class="d-flex justify-content-between">
								<span class="fw-bold text-dark">@comment.UserName</span>
								<small class="text-muted">@comment.CreationTime.ToString("dd.MM.yyyy HH:mm")</small>
							</div>
							<p class="mb-0 mt-1 text-secondary">@comment.Content</p>
						</abp-column>
					</abp-row>
				}
			}
		</div>

		@if (CurrentUser.IsAuthenticated)
		{
			<abp-row class="mt-3">
				<abp-column size="_12">
					<abp-input asp-for="@Model.NewCommentContent" label="@L["WriteAComment"].Value" rows="3" placeholder="@L["WriteACommentPlaceholder"].Value" />
				</abp-column>
				<abp-column size="_12" class="text-end">
					<abp-button button-type="Primary" icon="paper-plane"
								text="@L["Send"].Value"
								id="btn-send-comment"
								data-id="@Model.FeatureRequest.Id" />
				</abp-column>
			</abp-row>
		}
		else
		{
			<abp-alert type="Warning" class="mt-3">
				@L["LoginToCommentMessage", "/Account/Login"]
			</abp-alert>
		}

	</abp-modal-body>

	<abp-modal-footer buttons="@(AbpModalButtons.Close)"></abp-modal-footer>
</abp-modal>